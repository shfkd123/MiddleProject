<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="project">
<!-- 프로젝트 수정은 불가능합니다 -->

	<select id="getAllProject" parameterClass="kr.or.ddit.project.vo.ProjectVO" resultClass="kr.or.ddit.project.vo.ProjectVO">
		SELECT   A.PJ_NM            pjNm
				,A.PJ_TYPE          pjType
				,A.PJ_NAME          pjName
				,A.PJ_CONTENT       pjContent
				,A.PJ_PRICE_AMOUNT  pjPriceAmount
				,A.PJ_CONDITION     pjCondition
				,A.PJ_DDAY          pjDday
				,A.PJ_OPENDAY       pjOpenday
				,A.PJ_REWARD        pjReward
				,(
				 	SELECT USER_NICKNAME 
				 	FROM   TB_USER
				 	WHERE  USER_ID = A.USER_ID
			 	)                   pjWriter
				,NVL(ATCH_FILE_ID, 0)       atchFileId
				,A.PJ_CATEGORY      pjCategory
				,A.PJ_ACNTBANK      pjAcntBank
				,A.PJ_ACNTNUM       pjAcntNum
				,A.PJ_ACNTHOLDER    pjAcntHolder
		FROM  PROJECT A		
	</select>

	<select id="getProject" parameterClass="String" resultClass="kr.or.ddit.project.vo.ProjectVO">
		SELECT   A.PJ_NM            pjNm
				,A.PJ_TYPE          pjType
				,A.PJ_NAME          pjName
				,A.PJ_CONTENT       pjContent
				,A.PJ_PRICE_AMOUNT  pjPriceAmount
				,A.PJ_CONDITION     pjCondition
				,A.PJ_DDAY          pjDday
				,A.PJ_OPENDAY       pjOpenday
				,A.PJ_REWARD        pjReward
				,(
				 	SELECT USER_NICKNAME 
				 	FROM   TB_USER
				 	WHERE  USER_ID = A.USER_ID
			 	)                   pjWriter
				,NVL(ATCH_FILE_ID, 0)       atchFileId
				,A.PJ_CATEGORY      pjCategory
				,A.PJ_ACNTBANK      pjAcntBank
				,A.PJ_ACNTNUM       pjAcntNum
				,A.PJ_ACNTHOLDER    pjAcntHolder
		FROM  PROJECT A		
		WHERE  1=1
		AND    A.PJ_NM = #pjNm#
	</select>
	
	<insert id="insertProject" parameterClass="kr.or.ddit.project.vo.ProjectVO">
		<selectKey keyProperty="pjNm" resultClass="Long">
		SELECT PROJECT_SEQ.NEXTVAL AS pjNm FROM DUAL
		</selectKey>
	    INSERT INTO PROJECT(
	        PJ_NM
	        , PJ_TYPE
	        , PJ_NAME
	        , PJ_CONTENT
	        , PJ_PRICE_AMOUNT
	        , PJ_CONDITION
	        , PJ_DDAY
	        , PJ_OPENDAY
	        , PJ_REWARD
	        , USER_ID
	        , ATCH_FILE_ID
	        , PJ_CATEGORY
	        , PJ_ACNTBANK
	        , PJ_ACNTNUM
	        , PJ_ACNTHOLDER       
	        ) 
	    VALUES (
	        #pjNm# 
	        , #pjType#          
	        , #pjName#          
	        , #pjContent#       
	        , #pjPriceAmount#   
	        , #pjCondition#     
	        , #pjDday#          
	        , SYSDATE       
	        , #pjReward#
	        , #userId#
	        , #atchFileId#   
	        , #pjCategory#
	        , #pjAcntBank#
	        , #pjAcntNum#
	        , #pjAcntHolder#     
	    )
	</insert>
	
	<delete id="deleteProject" parameterClass="kr.or.ddit.project.vo.ProjectVO">
		DELETE FROM PROJECT
		WHERE  PJ_NM = #pjNm#
	</delete>
	
	<select id="searchProject" parameterClass="String" resultClass="kr.or.ddit.project.vo.ProjectVO">
		SELECT   A.PJ_NM            pjNm
				,A.PJ_TYPE          pjType
				,A.PJ_NAME          pjName
				,A.PJ_CONTENT       pjContent
				,A.PJ_PRICE_AMOUNT  pjPriceAmount
				,A.PJ_CONDITION     pjCondition
				,A.PJ_DDAY          pjDday
				,A.PJ_OPENDAY       pjOpenday
				,A.PJ_REWARD        pjReward
				,b.user_nickname    pjWriter
				,A.ATCH_FILE_ID     atchFileId
				,A.PJ_CATEGORY      pjCategory
				,A.PJ_ACNTBANK      pjAcntBank
				,A.PJ_ACNTNUM       pjAcntNum
				,A.PJ_ACNTHOLDER    pjAcntHolder
		FROM   PROJECT A INNER JOIN TB_USER B ON(A.USER_ID = B.USER_ID)
        WHERE 1=1
		OR     A.PJ_TYPE       LIKE '%' || #pjType#      || '%'                                  
		OR     A.PJ_NAME       LIKE '%' || #pjName#      || '%'  
		OR     A.PJ_CONDITION  LIKE '%' || #pjCondition# || '%'  
		OR     A.PJ_CATEGORY   LIKE '%' || #pjCategory#  || '%'  
		OR     B.USER_NICKNAME LIKE '%' || #pjWriter#    || '%'  	
	</select>                    

	<select id="getProjectAllCount" resultClass="int">
		SELECT COUNT(*)
		FROM PROJECT
	</select>	                                                             
</sqlMap>