<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap
   PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
   "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="noticeBoard">

<!-- 공지사항 등록 -->
<insert id="insertNoticeBoard" parameterClass="kr.or.ddit.board.vo.NoticeBoardVO">
	INSERT INTO NOTICE_BOARD (
	NOTICE_NM
	,NOTICE_TITLE
	,NOTICE_CONTENT
	,NOTICE_DATE
	,USER_ID
	,ATCH_FILE_ID

	) VALUES(
	NOTICE_BOARD_SEQ.NEXTVAL
	,#noticeTitle#
	,#noticeContent#
	,SYSDATE
	,#noticeWriter#
	,#atchFileId#
	)
</insert>

<!-- 공지사항 조회 -->
<select id="getNoticeBoardList" resultClass="kr.or.ddit.board.vo.NoticeBoardVO">
	SELECT B.*
		FROM 
			(SELECT AAA.*, ROWNUM RNUM
			FROM(
					SELECT AA.NOTICE_NM       noticeNm
			 			 , AA.NOTICE_TITLE    noticeTitle
			 			 , AA.NOTICE_CONTENT  noticeContent
			 			 , TO_CHAR(AA.NOTICE_DATE, 'YYYY-MM-DD')     noticeDate
			 			 , (
			 				SELECT USER_NICKNAME 
			 				FROM   TB_USER
			 				WHERE  USER_ID = AA.USER_ID
			 				)            noticeWriter
						 , AA.ATCH_FILE_ID atchFileId
					FROM   (SELECT A.*
								 , ROWNUM AS RNUM
							FROM   NOTICE_BOARD A) AA
					WHERE  AA.NOTICE_STATE = 'Y'
					ORDER  BY 1 DESC) AAA
				) B
		WHERE RNUM
		BETWEEN #firstRecNo# AND #lastRecNo#
</select>

<!-- 공지사항 수정 -->
<update id="updateNoticeBoard" parameterClass="kr.or.ddit.board.vo.NoticeBoardVO">
	UPDATE NOTICE_BOARD
	SET 
	 NOTICE_TITLE = #noticeTitle#
	, NOTICE_CONTENT = #noticeContent#
	, ,NOTICE_DATE    = SYSDATE
	, ATCH_FILE_ID = #atchFileId#
	WHERE NOTICE_NM = #noticeNm#
</update>

<!-- 공지사항 삭제 -->
<delete id="deleteNoticeBoard" parameterClass="String">
	UPDATE NOTICE_BOARD
		SET    NOTICE_STATE = 'N'
		WHERE  NOTICE_NM = #noticeNm#
</delete>

<!-- 공지사항  검색 -->
<select id="getsearchNoticeBoard" parameterClass="String" resultClass="kr.or.ddit.board.vo.NoticeBoardVO">
	SELECT NOTICE_NM      noticeNm
		 , NOTICE_TITLE   noticeTitle
		 , NOTICE_CONTENT noticeContent
		 , TO_CHAR(NOTICE_DATE, 'YYYY-MM-DD') noticeDate
		 , USER_ID noticeWriter
	FROM NOTICE_BOARD
	WHERE NOTICE_TITLE LIKE '%' || #noticeTitle# || '%'
</select>

<!-- 해당번호에 해당하는 공지사항 조회 -->
<select id="getNoticeBoardInfo" resultClass="kr.or.ddit.board.vo.NoticeBoardVO">
	SELECT A.NOTICE_NM      noticeNm
			 , A.NOTICE_TITLE   noticeTitle
			 , A.NOTICE_CONTENT noticeContent
			 , A.NOTICE_DATE    noticeDate
			 , (
			 	SELECT USER_NICKNAME 
			 	FROM   TB_USER
			 	WHERE  USER_ID = A.USER_ID
			 	)			  noticeWriter 
			 , A.ATCH_FILE_ID atchFileId
		FROM   NOTICE_BOARD A			
		WHERE  1=1
		AND    A.NOTICE_NM = #noticeNm#
		AND    A.NOTICE_STATE = 'Y'
</select>

<!-- 모든 게시글의 갯수 -->
<select id="getNoticeBoardListCount" resultClass="int">
	SELECT COUNT(*) cnt
	FROM   NOTICE_BOARD
	WHERE  NOTICE_STATE = 'Y'
</select>
</sqlMap>